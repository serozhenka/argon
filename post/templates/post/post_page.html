{% extends 'base.html' %}
{% load static %}

{% block content %}

    <section class="mt-3">
        <div class="row mx-0">
            <div class="col-xl-8 col-lg-5 col-md-6 col-sm-8 col-10 mx-auto">
                <div class="d-flex bg-light rounded box-shadow">
                    <div class="col-7">
                        {% if post.post_images.all.count == 1 %}
                            <img src="{{ post.post_images.all.0.image.url }}" class="img-fluid" id="${post.id}_image_0" style="border-radius: 0!important">
                        {% endif %}
                    </div>

                    <div class="col-5 d-flex flex-column">
                        <div class="d-flex align-items-center p-3">
                            <div class="col-1 me-2">
                                <a href="{% url 'account:account' username=post.user.username %}">
                                    <img class="img-fluid rounded-circle" src="{{ post.user.image.url }}" alt="" id="{{ post.id }}_profile_image">
                                </a>
                            </div>
                            <div class="col-11">
                               <a href="{% url 'account:account' username=post.user.username %}" class="fw-bold link text-dark">{{ post.user.username }}</a>
                            </div>
                        </div>

                        <hr class="mt-0 mx-2"/>

                        <div class="d-flex flex-grow-1">
                            hello world
                        </div>

                        <hr class="mt-0 mx-2"/>

                        <div class="px-3 mb-2">
                            <div class="d-flex">
                                <i class="fa-light text-danger fa-heart fs-5 me-3" id="${post.id}_like" data-post_id="{{post.id}}" data-action=""></i>
                            </div>

                          <div class="mt-1">
                              <span class="fw-bold" id="{post.id}}_likes_count">{{post.likes_count}}</span> <span id="{{ post.id }}_like_word">like{{ post.likes_count|pluralize:'s' }}</span>
                          </div>

                          <p class="card-text fs-14px mt-1 mb-2 text-muted">{{post.description}}</p>
                          <div class="text-muted fs-14px">{{post.timestamp}}</div>
                        </div>
                    </div>
                </div>
            </div>

{#                <div class="card mt-3 box-shadow">#}
{#                    <div class="card-header d-flex align-items-center">#}
{#                       <div class="col-1 me-2">#}
{#                           <a href="{% url 'account:account' username=post.user.username %}">#}
{#                               <img class="img-fluid rounded-circle" src="{% static 'images/default.png' %}" alt="" id="${post.id}_profile_image">#}
{#                           </a>#}
{#                       </div>#}
{#                       <div class="col-11">#}
{#                           <a href="{% url 'account:account' username=post.user.username %}" class="fw-bold link text-dark">${post.user.username}</a>#}
{#                       </div>#}
{#                    </div>#}
{#                </div>#}
            </div>
        </div>
    </section>

    <script>


        {#function containerAppendData(data) {#}
        {#  data.forEach(function(post, i) {#}
        {#    let div = document.createElement('div')#}
        {#    div.classList.add(`card`,`mt-3`, `box-shadow`)#}
        {#    let user_href = "{% url 'account:account' username=123456789 %}".replace(123456789, post.user.username)#}
        {##}
        {#    div.innerHTML += `#}
        {#       <div class="card-header d-flex align-items-center">#}
        {#           <div class="col-1 me-2">#}
        {#               <a href="${user_href}">#}
        {#                   <img class="img-fluid rounded-circle" src="{% static 'images/default.png' %}" alt="" id="${post.id}_profile_image">#}
        {#               </a>#}
        {#           </div>#}
        {#           <div class="col-11">#}
        {#               <a href="${user_href}" class="fw-bold link text-dark">${post.user.username}</a>#}
        {#           </div>#}
        {#       </div>#}
        {#    `#}
        {##}
        {#    if (post.post_images.length === 1) {#}
        {#      div.innerHTML += `<img src="{% static 'images/default.png' %}" class="card-img-top" id="${post.id}_image_0" style="border-radius: 0!important">`#}
        {#    } else {#}
        {##}
        {#      let carouselButtons = post.post_images.map((item, i) => {#}
        {#        return `<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="${i}" class="${i === 0 ? "active": ""}"></button>`#}
        {#      }).join("")#}
        {##}
        {#      let carouselImages = post.post_images.map((item, i) => {#}
        {#        return `<div class="carousel-item ${i === 0 ? "active" : ""}">#}
        {#            <img src="{% static 'images/gray-bg.png' %}" class="d-block w-100" id="${post.id}_image_${i}" style="border-radius: 0!important">#}
        {#         </div>`#}
        {#      }).join("")#}
        {##}
        {##}
        {#      div.innerHTML += `#}
        {#           <div id="carouselExampleIndicators" class="carousel slide rounded box-shadow" data-bs-interval="false">#}
        {#              <div class="carousel-indicators" id="carouselButtonsIndicators">#}
        {#                  ${carouselButtons}#}
        {#              </div>#}
        {#              <div class="d-flex align-items-center carousel-inner" id="carouselImagesIndicators" style="background-color: var(--semi-gray-color);">#}
        {#                  ${carouselImages}#}
        {#              </div>#}
        {#          </div>#}
        {#      `#}
        {#    }#}
        {##}
        {#    div.innerHTML += `#}
        {#       <div class="card-body">#}
        {#          <div class="d-flex">#}
        {#              <i class="${post.is_liked ? "fa-light": "fa-solid" } text-danger fa-heart fs-5 me-3" id="${post.id}_like" data-post_id="${post.id}" data-action="${post.is_liked ? "dislike":"like" }"></i>#}
        {#              <i class="fa-light fa-comment fs-5"></i>#}
        {#          </div>#}
        {##}
        {#          <div class="mt-1">#}
        {#              <span class="fw-bold" id="${post.id}_likes_count">${post.likes_count}</span> like${ post.likes_count === 1 ? "s" : "" }#}
        {#          </div>#}
        {##}
        {#          <p class="card-text fs-14px mt-1 text-muted">${post.description}</p>#}
        {#      </div>#}
        {#    `#}
        {#    postContainer.appendChild(div)#}
        {##}
        {#    for (let i = 0; i < post.post_images.length; i++) {#}
        {#        preLoadImage(post.post_images[i].image, `${post.id}_image_${i}`)#}
        {#        document.getElementById(`${post.id}_like`).addEventListener('click', postLike)#}
        {#    }#}
        {##}
        {#    preLoadImage(post.user.image, `${post.id}_profile_image`)#}
        {#  })#}
        {# }#}

        {#function postLike(e) {#}
        {#    let action = e.target.dataset.action#}
        {#    if (!['like', 'dislike'].includes(action)) { return }#}
        {##}
        {#    fetch(postLikeUrl.replace(123456789, e.target.dataset.post_id), {#}
        {#      method: 'POST',#}
        {#      headers: {#}
        {#        'X-CSRFToken': "{{ csrf_token }}",#}
        {#        'Content-Type': 'application/json',#}
        {#      },#}
        {#      body: JSON.stringify({'action': e.target.dataset.action})#}
        {#    })#}
        {#    .then(response => response.json())#}
        {#    .then(data => {#}
        {#      if (data.response_result === "success") {#}
        {#          e.target.classList.remove(data.is_liked ? 'fa-light': 'fa-solid')#}
        {#          e.target.classList.add(data.is_liked ? 'fa-solid': 'fa-light')#}
        {##}
        {#          let likesCountBtn = document.getElementById(`${e.target.dataset.post_id}_likes_count`)#}
        {#          likesCountBtn.innerText = String(Number(likesCountBtn.innerText) + (data.is_liked ? 1:-1))#}
        {#      }#}
        {#     })#}
        {# }#}


    </script>
{% endblock content %}